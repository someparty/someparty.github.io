import{Controller}from"https://unpkg.com/@hotwired/stimulus/dist/stimulus.js";import{spinner}from"../spinner.js";export default class extends Controller{async connect(){this.inputTarget;const e=new URLSearchParams(window.location.search),t=e.get("email"),s=e.get("uuid");t&&s&&(this.checkSwalLoaded=setInterval((async()=>{window.Swal&&(clearInterval(this.checkSwalLoaded),await this.promptUnsubscribe(t,s))}),100))}async promptUnsubscribe(e,t){var s={email:e,uuid:t};const i=await Swal.fire({title:"Confirm Unsubscribe",text:`Please confirm that you'd like unsubscribe ${e} from the newsletter.`,showDenyButton:!0,showCancelButton:!1,confirmButtonText:"Yes, Unsubscribe Me",denyButtonText:"Nevermind",icon:"question"});if(i.isConfirmed){Swal.fire({title:"Please wait",html:spinner,showCloseButton:!1,showCancelButton:!1,showConfirmButton:!1,allowOutsideClick:!1});try{const e=await fetch("https://api.someparty.ca/some_party_unsubscribe",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)}),t=await e.text();await Swal.fire("Unsubscribe Request Submitted",t,"success")}catch(e){await Swal.fire("Unsubscribe Error",e,"error")}}else i.isDenied&&Swal.fire("Unsubscribe cancelled","You're still subscribed to Some Party.","info")}}