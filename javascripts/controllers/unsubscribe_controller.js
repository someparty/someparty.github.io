import{Controller}from"https://unpkg.com/@hotwired/stimulus/dist/stimulus.js";import{spinner}from"../spinner.js";export default class extends Controller{async connect(){this.inputTarget;const e=new URLSearchParams(window.location.search),t=e.get("email"),s=e.get("uuid");if(t&&s){var i={email:t,uuid:s};document.addEventListener("DOMContentLoaded",(async()=>{const e=await Swal.fire({title:"Confirm Unsubscribe",text:`Please confirm that you'd like unsubscribe ${t} from the newsletter?`,showDenyButton:!0,showCancelButton:!1,confirmButtonText:"Yes, Unsubscribe Me",denyButtonText:"Nevermind",icon:"question"});if(e.isConfirmed){Swal.fire({title:"Please wait",html:spinner,showCloseButton:!1,showCancelButton:!1,showConfirmButton:!1,allowOutsideClick:!1});try{const e=await fetch("https://api.someparty.ca/some_party_unsubscribe",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)}),t=await e.text();await Swal.fire("Unsubscribe Request Submitted",t,"success")}catch(e){await Swal.fire("Unsubscribe Error",e,"error")}}else e.isDenied&&Swal.fire("Unsubscribe cancelled","You're still subscribed to Some Party.","info")}))}}}